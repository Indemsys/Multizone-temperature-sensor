// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// 2022-09-26
// 17:48:23
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#include   "App.h"

static MUTEX_STRUCT   spi0_mutex;


/*-----------------------------------------------------------------------------------------------------


  \param void
-----------------------------------------------------------------------------------------------------*/
void SPI0_Init_Bus(void)
{
  Create_mutex_P_inhr_P_queue(&spi0_mutex);
  SPI_master_init(BUS_SPI0, SPI_8_BITS, 0, 0, SPI_BAUD_30MHZ, 0,  0);
  Init_SPI0_bus_DMA();
  SPI0_stop();
}

/*-----------------------------------------------------------------------------------------------------


  \param void
-----------------------------------------------------------------------------------------------------*/
void SPI0_bus_lock_for_TFT(void)
{
  _mutex_lock(&spi0_mutex);
  SPI0_set_CTAR(SPI_8_BITS, 0, 0, SPI_BAUD_30MHZ);
  SPI0_start();
}

/*-----------------------------------------------------------------------------------------------------


  \param void
-----------------------------------------------------------------------------------------------------*/
void SPI0_bus_lock_for_LSM6DSO32(void)
{
  _mutex_lock(&spi0_mutex);
  SPI0_set_CTAR(SPI_8_BITS, 0, 0, SPI_BAUD_10MHZ);
  SPI0_start();
}

/*-----------------------------------------------------------------------------------------------------


  \param void
-----------------------------------------------------------------------------------------------------*/
void SPI0_bus_unlock(void)
{
  SPI0_stop();
  _mutex_unlock(&spi0_mutex);
}


